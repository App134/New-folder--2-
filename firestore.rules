rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    
    // User data - each user can only access their own data
    match /users/{userId}/{document=**} {
      // Allow read and write only if the authenticated user's ID matches the userId
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Explanation:
    // - request.auth != null: Ensures the user is authenticated
    // - request.auth.uid == userId: Ensures the user can only access their own documents
    // - {document=**}: Applies to all subcollections (financial_data, goals, notifications, settings)
    
    // This ensures:
    // ✓ Users can read their own financial_data, goals, notifications, and settings
    // ✓ Users can create new documents in their own collections
    // ✓ Users can update their own documents
    // ✓ Users can delete their own documents
    // ✗ Users CANNOT access other users' data
    // ✗ Unauthenticated users CANNOT access any data
  }
}
